var phonecatApp = angular.module("lhcApp", ["lhcAppServices", "lhcAppControllers"]), services = angular.module("lhcAppServices", []), lhcAppControllers = angular.module("lhcAppControllers", ["checklist-model"]); angular.element(document).ready(function () { var t = angular.element(document.querySelector("form")); t.triggerHandler("$destroy") }), services.factory("LiveHelperChatFactory", ["$http", "$q", function (t, i) { return this.loadChatList = function (e) { var a = i.defer(); return t.get(WWW_DIR_JAVASCRIPT + "chat/syncadmininterface" + e).success(function (t) { "undefined" != typeof t.error_url ? document.location = t.error_url : a.resolve(t) }).error(function () { a.reject("error") }), a.promise }, this.truncate = function (t, i, e) { return isNaN(i) && (i = 10), void 0 === e && (e = "..."), t.length <= i || t.length - e.length <= i ? t : String(t).substring(0, i - e.length) + e }, this }]), lhcAppControllers.controller("LiveHelperChatCtrl", ["$scope", "$http", "$location", "$rootScope", "$log", "$interval", "LiveHelperChatFactory", function (t, i, e, a, n, s, o) { t.predicate = "last_visit", t.pending_chats = {}, t.pending_chats_expanded = !0, t.active_chats = {}, t.active_chats_expanded = !0, t.my_active_chats_expanded = !0, t.closed_chats = {}, t.closed_chats_expanded = !0, t.unread_chats = {}, t.unread_chats_expanded = !0, t.transfer_dep_chats = {}, t.transfer_chats = {}, t.timeoutControl = null, t.setTimeoutEnabled = !0, t.custom_list_1_expanded = !0, t.custom_list_2_expanded = !0, t.custom_list_3_expanded = !0, t.custom_list_4_expanded = !0; var l = this; this.restoreLocalSetting = function (t, i, e) { if (localStorage) { var a = localStorage.getItem(t); return null !== a ? 1 == e ? a.split(",") : a : i } }, this.limita = this.restoreLocalSetting("limita", 10, !1), this.limitu = this.restoreLocalSetting("limitu", 10, !1), this.limitp = this.restoreLocalSetting("limitp", 10, !1), this.limito = this.restoreLocalSetting("limito", 10, !1), this.lastidEvent = 0, this.actived = this.restoreLocalSetting("actived", [], !0), this.activedNames = [], this.departmentd = this.restoreLocalSetting("departmentd", [], !0), this.departmentdNames = [], this.unreadd = this.restoreLocalSetting("unreadd", [], !0), this.unreaddNames = [], this.pendingd = this.restoreLocalSetting("pendingd", [], !0), this.pendingdNames = [], this.operatord = this.restoreLocalSetting("operatord", [], !0), this.operatordNames = [], this.closedd = this.restoreLocalSetting("closedd", [], !0), this.closeddNames = [], this.storeLocalSetting = function (t, i) { if (localStorage) var i = localStorage.setItem(t, i) }, this.toggleList = function (i) { if (t[i] = !t[i], localStorage) try { localStorage.setItem(i, t[i]) } catch (e) { } }, t.getSyncFilter = function () { var t = "/(limita)/" + parseInt(l.limita); return t += "/(limitu)/" + parseInt(l.limitu), t += "/(limitp)/" + parseInt(l.limitp), t += "/(limito)/" + parseInt(l.limito), t += "/(limitc)/" + parseInt(l.limitc), t += "/(limitd)/" + parseInt(l.limitd), "object" == typeof l.actived && l.actived.length > 0 && (t += "/(actived)/" + l.actived.join("/")), "object" == typeof l.unreadd && l.unreadd.length > 0 && (t += "/(unreadd)/" + l.unreadd.join("/")), "object" == typeof l.pendingd && l.pendingd.length > 0 && (t += "/(pendingd)/" + l.pendingd.join("/")), "object" == typeof l.operatord && l.operatord.length > 0 && (t += "/(operatord)/" + l.operatord.join("/")), "object" == typeof l.closedd && l.closedd.length > 0 && (t += "/(closedd)/" + l.closedd.join("/")), "object" == typeof l.departmentd && l.departmentd.length > 0 && (t += "/(departmentd)/" + l.departmentd.join("/")), t }, t.$watch("lhc.limita", function (i, e) { i != e && (l.storeLocalSetting("limita", i), t.loadChatList()) }), this.setUpListNames = function (t) { angular.forEach(t, function (t) { l[t + "Names"] = [], angular.forEach(l[t], function (i) { l[t + "Names"].push(l.userDepartmentsNames[i]) }) }) }, this.setDepartmentNames = function (t) { l[t + "Names"] = [], angular.forEach(l[t], function (i) { l[t + "Names"].push(l.userDepartmentsNames[i]) }) }, this.departmentChanged = function (i) { if (l[i].length > 0) { var e = l[i].join("/"); "" != e && (l.storeLocalSetting(i, e), l.setDepartmentNames(i)) } else if (localStorage) try { localStorage.removeItem(i) } catch (a) { } t.loadChatList() }, t.$watch("lhc.limitu", function (i, e) { i != e && (l.storeLocalSetting("limitu", i), t.loadChatList()) }), t.$watch("lhc.limitp", function (i, e) { i != e && (l.storeLocalSetting("limitp", i), t.loadChatList()) }), t.$watch("lhc.limito", function (i, e) { i != e && (l.storeLocalSetting("limito", i), t.loadChatList()) }), t.loadChatList = function () { if (localStorage) try { t.pending_chats_expanded = "false" != localStorage.getItem("pending_chats_expanded"), t.active_chats_expanded = "false" != localStorage.getItem("active_chats_expanded"), t.my_active_chats_expanded = "false" != localStorage.getItem("my_active_chats_expanded"), t.closed_chats_expanded = "false" != localStorage.getItem("closed_chats_expanded"), t.unread_chats_expanded = "false" != localStorage.getItem("unread_chats_expanded"), t.custom_list_1_expanded = "false" != localStorage.getItem("custom_list_1_expanded"), t.custom_list_2_expanded = "false" != localStorage.getItem("custom_list_2_expanded"), t.custom_list_3_expanded = "false" != localStorage.getItem("custom_list_3_expanded"), t.custom_list_4_expanded = "false" != localStorage.getItem("custom_list_4_expanded") } catch (i) { } clearTimeout(t.timeoutControl), o.loadChatList(t.getSyncFilter()).then(function (i) { var e = !1, a = 0; angular.forEach(i.result, function (i, n) { t[n] = i, i.last_id_identifier && (void 0 == lhinst.trackLastIDS[i.last_id_identifier] ? lhinst.trackLastIDS[i.last_id_identifier] = parseInt(i.last_id) : lhinst.trackLastIDS[i.last_id_identifier] < parseInt(i.last_id) ? (lhinst.trackLastIDS[i.last_id_identifier] = parseInt(i.last_id), a != lhinst.trackLastIDS[i.last_id_identifier] && (a = lhinst.trackLastIDS[i.last_id_identifier], lhinst.playSoundNewAction(i.last_id_identifier, parseInt(i.last_id), i.nick ? i.nick : "Live Help", i.msg ? i.msg : confLH.transLation.new_chat), l.lastidEvent = parseInt(i.last_id))) : lhinst.trackLastIDS[i.last_id_identifier] > parseInt(i.last_id) && (lhinst.trackLastIDS[i.last_id_identifier] = parseInt(i.last_id)), 0 == i.last_id && (lhinst.trackLastIDS[i.last_id_identifier] = 0), parseInt(i.last_id) > 0 && l.lastidEvent == i.last_id && (e = !0)) }), 0 == e && lhinst.hideNotifications(), 0 == t.pending_chats.length && clearTimeout(lhinst.soundIsPlaying), 1 == t.setTimeoutEnabled && (t.timeoutControl = setTimeout(function () { t.loadChatList() }, confLH.back_office_sinterval)) }, function (i) { t.timeoutControl = setTimeout(function () { t.loadChatList() }, confLH.back_office_sinterval) }) }, this.previewChat = function (t) { lhc.previewChat(t) }, this.redirectContact = function (t, i) { return lhinst.redirectContact(t, i) }, this.startChatNewWindow = function (t, i) { return lhinst.startChatNewWindow(t, i) }, this.deleteChat = function (t, i, e) { return lhinst.deleteChat(t, i, e) }, this.getLimitChat = function () { return this.limitc = this.restoreLocalSetting("limitc", 0, !0), this.limitc }, this.getLimitAssign = function () { return this.limitd = this.restoreLocalSetting("limitd", 0, !0), this.limitd }, this.loggedUsers = function (t) { if (this.limitd = this.restoreLocalSetting("limitd", 0, !0), this.limitc = this.restoreLocalSetting("limitc", 0, !0), 0 == this.limitd) this.limitd = t, this.limitc = 0, l.storeLocalSetting("limitd", this.limitd), l.storeLocalSetting("limitc", this.limitc); else { var i = !1; if (this.limitd.forEach(function (e) { e == t && (i = !0) }), !i) { var e = new Array, a = new Array, n = 0, s = 0; this.limitd.forEach(function (t) { e[n] = t, n++ }), this.limitc.forEach(function (t) { a[s] = t, s++ }), e[n] = t, a[s] = 0, l.storeLocalSetting("limitd", e), l.storeLocalSetting("limitc", a) } } }, this.startChat = function (t, i, e) { if (this.start(e)) { if (this.increaseChatCount(e), $("#tabs").size() > 0) return lhinst.startChat(t, $("#tabs"), i); lhinst.startChatNewWindow(t, i) } }, this.logout = function (t) { var i = new Array, e = 0; this.limitd.forEach(function (a) { a == t || (i[e] = a, e++) }), l.storeLocalSetting("limitd", i) }, this.increaseChatCount = function (t) { this.limitd = this.restoreLocalSetting("limitd", 0, !0); var i = 0; this.limitd.forEach(function (e) { e == t && (l.limitc = l.restoreLocalSetting("limitc", 0, !0), l.limitc[i]++), i++ }), l.storeLocalSetting("limitc", this.limitc), l.storeLocalSetting("limitd", this.limitd) }, this.start = function (t) { l.limitd = this.restoreLocalSetting("limitd", 0, !0), l.limitc = l.restoreLocalSetting("limitc", 0, !0); var i = l.limitd[0], e = 0, a = 0; return l.limitc.forEach(function (t) { i >= t && (a = e, i = t), e++ }), l.limitd[a] == t ? !0 : !1 }, this.startChatNewWindowTransfer = function (t, i, e) { return lhinst.startChatNewWindowTransfer(t, i, e) }, this.startChatTransfer = function (t, i, e) { return lhinst.startChatTransfer(t, $("#tabs"), i, e) }, this.startChatOperator = function (t) { window.open(WWW_DIR_JAVASCRIPT + "chat/startchatwithoperator/" + t, "operatorchatwindow-" + t, "menubar=1,resizable=1,width=780,height=450") }, this.onlineOps = function (t) { alert(t) }, t.clicki = 1, this.setClick = function (i) { t.clicki = i, alert(t.clicki) }, t.loadChatList() }]);